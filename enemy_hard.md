# Enemy-hard.md - 2단계 공격 패턴 적들

## 🎯 구현 대상 적군

### 1. 폭격수 (Bomber)
- **외형**: 🟣 보라 육각형 (20x20px)
- **특징**: 포물선 투사체, 범위 폭발 데미지
- **역할**: 지역 거부, 플레이어 이동 제한

### 2. 기관총수 (Gunner)  
- **외형**: 🟨 노란 삼각형 (15x15px)
- **특징**: 연속 발사, 버스트 공격 패턴
- **역할**: 집중 화력, 순간 위협도 증가

## 🔧 핵심 기술적 구현 포인트

### 폭격수 - 범위 공격 시스템

**주요 기술적 도전:**

1. **포물선 투사체 계산**
   - 직선이 아닌 아크(호) 궤적으로 날아가는 투사체
   - 중력 시뮬레이션 또는 베지어 곡선을 통한 궤적 계산
   - 착탄 시간 예측: 플레이어가 이동할 시간 고려한 예상 위치 계산
   - **핵심 이슈**: 실시간 궤적 계산 vs 미리 계산된 룩업테이블 성능 비교

2. **범위 폭발 시스템**
   - 폭발 중심점에서 일정 반경 내 모든 대상에게 데미지
   - 폭발 데미지 거리별 감쇠 계산 (중심부 100% → 가장자리 30%)
   - 벽이나 장애물에 의한 폭발 차단 여부 결정
   - **성능 이슈**: 폭발마다 모든 엔티티와 거리 계산 → 최적화 필요

3. **예측 발사 알고리즘**
   - 플레이어 현재 velocity 기반 2-3초 후 위치 예측
   - 플레이어가 직선으로 이동한다고 가정 vs 더 복잡한 이동 패턴 예측
   - 예측 정확도 설정: 100% 정확하면 피할 수 없음, 너무 부정확하면 위협이 안됨
   - **밸런싱 포인트**: 70-80% 명중률이 적절한 도전감 제공

4. **폭탄 시각적 표현**
   - 발사된 폭탄의 실시간 궤적 표시
   - 착탄 예정 지점에 경고 원형 또는 십자 표시
   - 폭발 예고 타이밍: 너무 늦으면 피할 수 없고, 너무 이르면 긴장감 감소
   - **기술적 구현**: 착탄 1초 전부터 경고 표시, 0.3초 전부터 강조 표시

**성능 최적화 포인트:**
- 폭탄 궤적 계산을 발사 시 한 번만 하고 캐시
- 폭발 범위 계산 시 화면 밖 오브젝트 제외
- 동시 폭발 개수 제한 (최대 3-5개)
- 폭발 이펙트는 간단한 원형 확장 애니메이션으로 제한

**밸런싱 고려사항:**
- 폭탄 발사 간격: 4-5초 (너무 자주 발사하면 회피 불가능)
- 폭발 반경: 플레이어가 충분히 벗어날 수 있는 크기
- 폭탄 비행 시간: 2-3초 (너무 빠르면 반응 불가, 너무 느리면 긴장감 부족)

### 기관총수 - 버스트 공격 시스템

**주요 기술적 도전:**

1. **연속 발사 타이밍 관리**
   - 3발 연속 발사, 각 발사 간격 0.2-0.3초
   - 버스트 완료 후 2-3초 쿨다운 시간
   - 발사 중 플레이어가 이동하면 조준 업데이트 vs 고정 조준
   - **상태 머신**: IDLE → AIMING → BURST_FIRING → COOLDOWN

2. **조준 및 발사 방향 계산**
   - 첫 번째 발사는 플레이어 현재 위치 조준
   - 두 번째, 세 번째 발사는 플레이어 이동 방향 예측
   - 조준 시간: 1초 예고 → 0.5초 조준 → 연속 발사 시작
   - **기술적 이슈**: 각 발사마다 새로 조준 vs 첫 조준으로 3발 모두 발사

3. **발사 패턴 다양화**
   - 기본: 플레이어 방향으로 직선 3발
   - 변형1: 부채꼴 패턴 (조금씩 각도 벌어짐)
   - 변형2: 예측 발사 (플레이어 이동 경로 차단)
   - **난이도별 적용**: 초반엔 직선, 후반엔 부채꼴/예측 패턴

4. **발사 예고 시스템**
   - 조준선 표시: 기관총수에서 플레이어 방향으로 점선
   - 발사 예고: 조준 완료 0.3초 전 색상 변화 또는 깜빡임
   - 연속 발사 중 표시: 남은 발사 횟수 또는 진행 상태
   - **시각적 피드백**: 플레이어가 위험을 인지하고 회피할 시간 제공

**성능 최적화 포인트:**
- 투사체 오브젝트 풀링 (기관총수당 최대 3개 투사체)
- 조준선 계산은 상태 변경 시에만, 매 프레임 계산 금지
- 여러 기관총수 동시 발사 시 발사 타이밍 약간씩 분산

**밸런싱 고려사항:**
- 첫 발은 70% 명중률, 나머지는 50% 명중률 (완전 회피 가능하게)
- 조준 시간 충분히 제공: 플레이어가 위험을 인지하고 대응할 시간
- 쿨다운 시간 동안 무력화: 플레이어가 접근할 기회 제공

## 🎨 시각적 구분 및 피드백 시스템

### 폭격수 시각적 요소
- **발사 준비**: 크기가 약간 커지면서 색상이 진해짐
- **발사 순간**: 투사체 발사와 함께 반동 애니메이션
- **폭탄 궤적**: 포물선을 따라 이동하는 투사체 (그림자 효과 고려)
- **착탄 예고**: 착탄 지점에 점점 진해지는 빨간 원
- **폭발 이펙트**: 중심에서 바깥으로 확산되는 원형 파동

### 기관총수 시각적 요소  
- **조준 상태**: 플레이어 방향으로 회전, 조준선 표시
- **발사 예고**: 색상 변화 (노랑 → 빨강) 또는 크기 변화
- **연속 발사**: 발사할 때마다 반동 애니메이션, 머즐 플래시
- **쿨다운**: 색상이 어두워졌다가 점점 원래대로 복구
- **탄창 표시**: 남은 발사 횟수를 작은 점으로 표시 (●●●)

## 📊 스폰 및 조합 시스템

### 등장 타이밍
```
5분 이후 등장 시작:
- 폭격수: 15초마다 1마리씩 (최대 3마리 동시 존재)
- 기관총수: 20초마다 1마리씩 (최대 2마리 동시 존재)

7분 이후 본격 등장:
- 폭격수: 10초마다 1마리씩 (최대 5마리)  
- 기관총수: 15초마다 1마리씩 (최대 4마리)

10분 이후 최고 난이도:
- 폭격수와 기관총수 동시 등장
- 다른 적들과 조합하여 복합 위협 상황 연출
```

### 적 조합 전략
- **폭격수 + 추적자**: 폭격으로 이동 제한 → 추적자가 압박
- **기관총수 + 거인**: 기관총수가 견제하는 동안 거인이 접근
- **폭격수 + 저격수**: 원거리 집중 공격으로 플레이어 이동 강제

## ⚠️ 구현 시 주의사항

### 폭격수 관련
1. **폭발 데미지 중복 방지**
   - 같은 폭발에 여러 번 데미지 받지 않도록 처리 필요
   - 폭발 ID 또는 타임스탬프로 중복 데미지 방지

2. **폭탄 궤적 충돌 감지**
   - 벽을 통과해서 날아가는지, 벽에 부딪히면 조기 폭발하는지 결정
   - 벽 충돌 시 폭발 vs 튕김 vs 관통 정책 수립

3. **폭발 범위 최적화**  
   - 모든 엔티티와의 거리 계산 대신 공간 분할 활용
   - 폭발 반경 내 격자 셀만 검사하여 성능 개선

### 기관총수 관련
1. **발사 중단 조건**
   - 연속 발사 중 플레이어가 시야에서 벗어나면 발사 중단 vs 계속 발사
   - 발사 중 기관총수가 죽으면 남은 투사체 처리 방법

2. **조준 정확도 조정**
   - 거리별 명중률 조정: 가까우면 높은 명중률, 멀면 낮은 명중률
   - 플레이어 이동 속도에 따른 명중률 보정

3. **투사체 충돌 처리**
   - 벽 관통 여부, 다른 적 관통 여부 결정
   - 투사체끼리 충돌 시 처리 방법

## 🔍 테스트 체크리스트

### 폭격수 테스트
- [ ] 폭탄이 예상 궤적을 따라 날아가는가?
- [ ] 착탄 지점 예고가 적절한 타이밍에 표시되는가?
- [ ] 폭발 범위 계산이 정확한가?
- [ ] 벽 근처 폭발 시 이상 현상 없는가?
- [ ] 여러 폭격수가 동시에 있어도 성능 문제 없는가?
- [ ] 폭발 데미지 중복 적용되지 않는가?

### 기관총수 테스트  
- [ ] 3발 연속 발사가 정확한 간격으로 이루어지는가?
- [ ] 조준 예고가 충분한 시간 동안 표시되는가?
- [ ] 발사 중 플레이어 이동 시 적절히 대응하는가?
- [ ] 쿨다운 시간이 정확히 지켜지는가?
- [ ] 여러 기관총수의 발사 타이밍이 겹치지 않는가?
- [ ] 투사체가 정확한 방향으로 발사되는가?

### 조합 테스트
- [ ] 폭격수 + 다른 적 조합 시 과도하게 어렵지 않은가?
- [ ] 기관총수 + 다른 적 조합 시 플레이어가 대응할 방법이 있는가?
- [ ] 두 공격 패턴이 동시에 발동될 때 성능 문제 없는가?

## 🎯 발전 단계별 구현 순서

### 1단계: 기본 공격 패턴
- 폭격수: 직선 궤적, 고정 착탄 지점
- 기관총수: 플레이어 현재 위치로만 발사

### 2단계: 예측 시스템 추가  
- 폭격수: 플레이어 이동 방향 예측 발사
- 기관총수: 첫 발 이후 예측 발사

### 3단계: 고급 패턴
- 폭격수: 포물선 궤적, 거리별 데미지 감쇠
- 기관총수: 부채꼴 패턴, 연속 조준 업데이트

이 단계별 접근을 통해 복잡도를 점진적으로 높여가며 안정적인 구현을 목표로 함.